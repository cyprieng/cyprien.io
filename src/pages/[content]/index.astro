---
import Posts from "@layouts/Posts.astro";
import { getPagination } from "@utils/getPagination";
import getSortedPosts from "@utils/getSortedPosts";
import { getCollection } from "astro:content";
import {
  CONTENT_TYPES,
  isValidContentType,
  getCollectionForContentType,
} from "@utils/contentConfig";

export async function getStaticPaths() {
  return Object.keys(CONTENT_TYPES).map((content) => ({
    params: { content },
  }));
}

const { content } = Astro.params;

if (!isValidContentType(content)) {
  return Astro.redirect("/404");
}

const collection = getCollectionForContentType(content);
const posts = await getCollection(collection);
const sortedPosts = getSortedPosts(posts);
const pagination = getPagination({
  posts: sortedPosts,
  page: 1,
  isIndex: true,
});
---

<Posts {...pagination} contentType={content} />
